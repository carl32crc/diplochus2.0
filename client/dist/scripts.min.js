angular.module('myPage',[ 'ngRoute','controllers','routes','services']);
angular.module( 'controllers', ['homeModule','myChartCreate','searchProvinceModule','searchModule','errorModule'] );


angular.module('routes',['routeHome','routeSearchProvince','routeError']);
angular.module('services',['provinceService']);
angular.module("homeModule", [])
	.controller("pieStatistics", function( $rootScope,$scope,$http,createObjectChartJs) {

		$rootScope.section ="pieStatistics";

		$http.get('/offers')
			.success(function(data) {

				createObjectChartJs.crateChartJs(data[0]._offersLanguage,'Programming Languages',data[0]._fivePosLang,'chart-area');
				createObjectChartJs.crateChartJs(data[0]._offersBackEnd,'Data Base',data[0]._fivePosBack,'chart-area2');
				createObjectChartJs.crateChartJs(data[0]._frameworks,'Frameworks',data[0]._fivePosFrameworks,'chart-area3');
				createObjectChartJs.crateChartJs(data[0]._othersskills,'Frameworks',data[0]._fivePosOtherSkills,'chart-area4');


				$scope.rankingAll         = data[0]._offersLanguage;
				$scope.rankingAllDb       = data[0]._offersBackEnd;
				$scope.rankingFrameworks  = data[0]._frameworks;
				$scope.rankingOtherSkills = data[0]._othersskills;

		})
		.error(function(data) {
			console.log('Error: ' + data);
		});

});
angular.module("routeHome",[])
	.config(function( $routeProvider ){

			$routeProvider
				.when('/offers',{
					templateUrl: 'js/module/home/offers.html',
					controller: 'pieStatistics'
				})

				.otherwise({ redirectTo: '/offers' });

	});
angular.module("errorModule", [])
	.controller("errorState", function( $rootScope) {

		$rootScope.errorMessage ="This dosn't exist...";
		$rootScope.emoji = "¯\\(°_o)/¯";

});
angular.module("routeError",[])
	.config(function( $routeProvider ){

			$routeProvider
				.when('/error-bad-request',{
					templateUrl: 'js/module/badrequest/error.html',
					controller: 'errorState'
				});

	});

angular.module("searchModule",[])
	.controller("searchAll", function( $rootScope,$scope,$http) {




});
angular.module("routeSearchProvince",[])
	.config(function( $routeProvider ){

			$routeProvider
				.when('/search-province/:province',{
					templateUrl: 'js/module/searchByProvince/search-province.html',
					controller: 'provinceStatistics'
				});

	});
angular.module("searchProvinceModule", [])
	.controller("provinceStatistics", function( $rootScope,$scope,$http,$routeParams,$window,provinceService,createObjectChartJs) {
 
			var province  = $routeParams.province.toLowerCase();

				provinceService.getProvince(province)
					.success(function(data) {
							if(data[0]===undefined){
								$window.location = "/#/error-bad-request";
							}else{
								$rootScope.province = province;
								$rootScope.emoji = "";
								var nameLanguages = $rootScope.province+"Languages";
								var nameDb = $rootScope.province+"Db";
								var nameFrames = $rootScope.province +"Frames";
								var nameOther=$rootScope.province +"Others";
								console.log(data[0][nameLanguages][0].num);

								createObjectChartJs.orderDescendingData(data[0][nameLanguages]);
								createObjectChartJs.orderDescendingData(data[0][nameDb]);
								createObjectChartJs.orderDescendingData(data[0][nameFrames]);
								createObjectChartJs.orderDescendingData(data[0][nameOther]);



								var prLang = createObjectChartJs.positionProvince(data[0][nameLanguages]);
								var prDb = createObjectChartJs.positionProvince(data[0][nameDb]);
								var prFrame = createObjectChartJs.positionProvince(data[0][nameFrames]);
								var prOther = createObjectChartJs.positionProvince(data[0][nameOther]);

								createObjectChartJs.getFirsFivePosition(prLang,data[0][nameLanguages]);
								createObjectChartJs.getFirsFivePosition(prDb,data[0][nameDb]);
								createObjectChartJs.getFirsFivePosition(prFrame,data[0][nameFrames]);
								createObjectChartJs.getFirsFivePosition(prOther,data[0][nameOther]);

								createObjectChartJs.crateChartJs(data[0][nameLanguages],'Programming Languages',prLang,'chart-area5');
								createObjectChartJs.crateChartJs(data[0][nameDb],'Programming Languages',prDb,'chart-area6');
								createObjectChartJs.crateChartJs(data[0][nameFrames],'Programming Languages',prFrame,'chart-area7');
								createObjectChartJs.crateChartJs(data[0][nameOther],'Programming Languages',prOther,'chart-area8');

								$scope.rankingAll         = data[0][nameLanguages];
								$scope.rankingAllDb       = data[0][nameDb];
								$scope.rankingFrameworks  = data[0][nameFrames];
								$scope.rankingOtherSkills = data[0][nameOther];
							}
					})
					.error(function(data) {
						console.log('Error: ' + data);
					});
	});
angular.module('provinceService',[])
	.factory('provinceService', function ($http) {

		var urlProvince =  '/search-province/<PROVINCE>';

		function getProvince ( valueToKey ) {
			var url  = urlProvince.replace('<PROVINCE>', valueToKey);
			return $http.get(url);
		}

	return {
			getProvince : getProvince
		};
	});